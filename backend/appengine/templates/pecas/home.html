{% extends 'base/base.html' %}
{% block js %}
    <script type="text/javascript" src="/static/angular/js/angular.min.js"></script>
    <script type="text/javascript" src="/static/peca/js/peca.js"></script>
{#    <script type="text/javascript" src="/static/peca/js/pecas_api_mock.js">#}
    <script type="text/javascript">

{#        var rest = angular.module('rest', []);#}
{#        rest.factory('PecasApi',function($http){#}
{#           return{#}
{#               salvar: function(pecas){#}
{#                   return $http.post('{{ rest_new_path }}',pecas);#}
{#               },#}
{#               listar: function(){#}
{#                   return $http.post('{{ rest_list_path }}', {});#}
{#               }#}
{#           };#}
{#        });#}



        var pecaApp = angular.module('pecaApp',['pecaModulo']);

        function PecaController($scope){
            $scope.pecas={title:'Teste',price:'1,00',amount:'20'};
            $scope.mostrarFormFlag=false;
            $scope.pecalista={{ peca_lista|safe or [] }};
            $scope.listandoFlag=false;
            $scope.postLista = "{{ rest_list_path }}";
            $scope.postNew = "{{ rest_new_path }}";
{#            PecasApi.listar().success(function(pecas){#}
{#                $scope.pecalista = pecas;#}
{#                $scope.listandoFlag=false;#}
{#            });#}
            $scope.mostrarOuEsconderForm=function(){
                $scope.mostrarFormFlag=!$scope.mostrarFormFlag;
            }
        }
    </script>
{% endblock %}
{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <br/>

                <div class="well" ng-app="pecaApp" ng-controller="PecaController">
                    <h1 class="text-center">Tabela de Peças </h1>

                <button class="btn btn-success" ng-click="mostrarOuEsconderForm()"> Nova Peça </button>
                <br/>
                <br/>
                <pecaform ng-show="mostrarFormFlag" pecas="pecalista" title-label="Titulo" price-label="Preço" amount-label="Quantidade" post-new="postNew"></pecaform>
                    <table class="table">
                        <thread>
                            <tr>
                                <th></th><th>id</th>
                                <th>Titulo</th>
                                <th>Preço</th>
                                <th>Quantidade</th>
                            </tr>
                        </thread>
                        <tbody>
                            <tr pecalinha ng-repeat="p in pecalista" pecas="p"></tr>
                        </tbody>
                    </table>
                    <img src="/static/img/ajax.gif" ng-show="listandoFlag" />

                </div>
            </div>
        </div>
    </div>

{% endblock %}